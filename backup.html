<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Backup e recupera√ß√£o</title>

  <!-- ===== GERADOR DE QR CODE ‚Äî BACKUP NOME + ID ===== -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

  <!-- ===== GERAR PDF DO QR CODE ===== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4f8;
      padding: 0px;
      text-align: center;
    }

    .container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 10px;
      box-sizing: border-box;
      text-align: center;
      overflow: hidden;
      min-height: 100vh;
    }




  /* Bot√µes principais ‚Äî 75% largura + estilo padr√£o */
.btn-principal {
  padding: 12px 24px;
  background: linear-gradient(to bottom, #02779e, #02779e);
  border: 2px solid #5fa5b4;
  color: white;
  font-size: 16px;
  width: 80%;
  text-decoration: none;
  cursor: pointer;
  border-radius: 20px;
  position: relative;
  overflow: hidden;
  margin: 15px auto;
  display: block;
  transition: background 0.3s;
}

.btn-principal::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 35%;
  background: linear-gradient(to bottom, #FFFFFF66, #FFFFFF00);
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  pointer-events: none;
}

.btn-principal:hover {
  background: linear-gradient(to bottom, #0393bb, #0393bb);
}


    .explicacao {
      font-size: 15px;
      color: #333;
      max-width: 600px;
      margin: 0 auto 25px auto;
      line-height: 1.6;
      text-align: left;
    }


/* üîô BOT√ÉO VOLTAR PADR√ÉO DO APP */
  .botao-voltar {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 20px;
    height: 30px;
    font-size: 24px;
    color: #7f8c8d;
    background: linear-gradient(to bottom, #f0f4f8, #f0f4f8);
    border: 2px solid #f0f4f8;
    border-radius: 5px;
    padding: 5px 15px;
  
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 999;
  }

  .botao-voltar::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(to bottom, #FFFFFF66, #FFFFFF00);
    border-top-left-radius: 5px;
    border-top-right-radius: 5px;
    pointer-events: none;
  }

  .botao-voltar:hover {
    background: linear-gradient(to bottom, #0393bb, #0393bb);
    border-color: #0393bb;
  }




  </style>
</head>

<body>

  <!-- BOT√ÉO VOLTAR -->
<a href="index.html" class="botao-voltar">‚Ä¢‚Ä¢‚Ä¢</a>

  <div class="container">

    <h3>Backup e recupera√ß√£o</h3>

    <p class="explicacao">
      Este recurso permite recuperar seu <strong>nome e ID</strong> caso os dados do aplicativo sejam apagados.
      <br><br>
      O QR Code funciona como uma chave de recupera√ß√£o pessoal.
    </p>

    <button id="btnGerarQR" class="btn-principal">
      üî≥ Gerar QR de recupera√ß√£o
    </button>

    <!-- ===== GERADOR DE QR CODE ‚Äî BACKUP NOME + ID ===== -->
<div id="qrContainer" style="
    margin-top:20px;
    display: flex;
    justify-content: center;
"></div>

    <!-- ===== BAIXAR QR CODE ‚Äî BACKUP NOME + ID ===== -->
<button id="btnBaixarPDF" class="btn-principal" style="display:none;">
  üìÑ Baixar QR em PDF
</button>


    <button id="btnLerQR" class="btn-principal">
      üì∑ Recuperar com QR Code
    </button>

 <!-- ===== Recuperar com QR Code ‚Äî BACKUP NOME + ID ===== -->
    <div id="leitorQR" style="display:none; margin-top:20px;"></div>

 <!-- ===== Linha divis√≥ria ===== -->
    <hr style="width: 75%; margin: 25px auto; border: 1px solid #ccc;">

    <p class="explicacao">
      <strong>Importante:</strong><br>
      Baixe o QR Code ou tire print, guarde em outro aparelho ou no computador.<br>
      Ele permite recuperar seu nome e ID caso os dados do site, que ficam em (Configura√ß√µes de site ‚Üí Dados armazenados), sejam apagados,
      pois todas as informa√ß√µes ficam armazenadas
      somente no celular e n√£o na internet.
  </div>


<!-- SCRIPT ABAIXO -->

 <!-- 1 ===== C√≥d bot√£o gerar QR code ===== -->
<script>
document.getElementById("btnGerarQR").addEventListener("click", () => {
    const container = document.getElementById("qrContainer");
    const btnPDF = document.getElementById("btnBaixarPDF");

    // üîÅ Se j√° existe QR, remove (fecha)
    if (container.innerHTML.trim() !== "") {
        container.innerHTML = "";
        btnPDF.style.display = "none";
        return;
    }

    const userName = localStorage.getItem("userName");
    const userID = localStorage.getItem("userID");

    if (!userName || !userID) {
        alert("Nome ou ID n√£o encontrados.");
        return;
    }

    const dados = JSON.stringify({ userName, userID });

    new QRCode(container, {
        text: dados,
        width: 220,
        height: 220
    });

    // ‚úÖ S√≥ mostra o bot√£o PDF depois que o QR existir
    btnPDF.style.display = "block";
});
</script>




<!-- 2 ===== GERAR PDF DO QR CODE ===== -->

<script>
document.getElementById("btnBaixarPDF").addEventListener("click", () => {
    const qrElement = document.querySelector("#qrContainer canvas, #qrContainer img");

    if (!qrElement) {
        alert("QR Code n√£o encontrado.");
        return;
    }

    let imgData;

    if (qrElement.tagName === "CANVAS") {
        imgData = qrElement.toDataURL("image/png");
    } else {
        imgData = qrElement.src;
    }

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    
// Borda da p√°gina

// Borda discreta
pdf.setLineWidth(0.2);
pdf.setDrawColor(180, 180, 180);
pdf.rect(
  10,
  10,
  pdf.internal.pageSize.getWidth() - 20,
  pdf.internal.pageSize.getHeight() - 20
);


const userName = localStorage.getItem("userName");
const userID = localStorage.getItem("userID");
const hoje = new Date().toLocaleDateString("pt-BR");

const pageWidth = pdf.internal.pageSize.getWidth();
const centerX = pageWidth / 2;

// T√≠tulo
pdf.setFontSize(18);
pdf.setFont(undefined, "bold");
pdf.text("Checkin+", centerX, 25, { align: "center" });

// Conte√∫do
pdf.setFontSize(12);
pdf.setFont(undefined, "normal");

pdf.text("Recupera√ß√£o de Dados", centerX, 38, { align: "center" });
pdf.text(`Usu√°rio: ${userName} (ID: ${userID})`, centerX, 48, { align: "center" });
pdf.text(`Data: ${hoje}`, centerX, 58, { align: "center" });

// QR centralizado
const qrSize = 90;
pdf.addImage(
  imgData,
  "PNG",
  centerX - qrSize / 2,
  75,
  qrSize,
  qrSize
);


// Informa√ß√£o abaixo do QR
const infoY = 75 + qrSize + 15;

// T√≠tulo em negrito
pdf.setFontSize(10);
pdf.setFont(undefined, "bold");
pdf.setTextColor(90, 90, 90);
pdf.text("Informa√ß√£o:", centerX, infoY, { align: "center" });


// Texto normal
pdf.setFont(undefined, "normal");
pdf.text(
  [
    
  "Guarde o QR Code em local seguro, como em outro aparelho ou no computador.",
  "Ele permite recuperar seu nome e ID caso os dados do site, que ficam",
  "em (Configura√ß√µes de site - Dados armazenados) sejam apagados,",
  "pois todas as informa√ß√µes ficam armazenadas",
  "somente no celular e n√£o na internet."

  ],
  centerX,
  infoY + 8,
  { align: "center" }
);




    pdf.save("qr-recuperacao.pdf");
});
</script>



<!-- 3 ===== LEITOR DE QR CODE ‚Äî RECUPERA√á√ÉO NOME + ID ===== -->
<script src="https://unpkg.com/html5-qrcode"></script>

<script>
document.getElementById("btnLerQR").addEventListener("click", () => {
    const area = document.getElementById("leitorQR");

    // toggle abrir / fechar c√¢mera
    if (area.style.display === "block") {
        area.style.display = "none";
        if (window.qrReader) {
            window.qrReader.stop();
        }
        return;
    }

    area.style.display = "block";

    window.qrReader = new Html5Qrcode("leitorQR");

    qrReader.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 220 },
        (texto) => {
            try {
                const dados = JSON.parse(texto);

                if (dados.userName && dados.userID) {
                    localStorage.setItem("userName", dados.userName);
                    localStorage.setItem("userID", dados.userID);

                    alert("Dados recuperados com sucesso!");
                    location.reload();
                } else {
                    alert("QR inv√°lido.");
                }
            } catch {
                alert("QR inv√°lido.");
            }
        }
    );
});
</script>

<!-- ===== GERAR  ===== -->




</body>
</html>

